{"version":3,"file":"index.js","sources":["../src/MapPicker.tsx"],"sourcesContent":["import React, { FC } from 'react'\n\nfunction isGoogleMapScriptLoaded(id: string): boolean {\n  const scripts: HTMLCollectionOf<HTMLScriptElement> = document.head.getElementsByTagName(\n    'script'\n  )\n  for (let i: number = 0; i < scripts.length; i++) {\n    if (scripts[i].getAttribute('id') === id) {\n      return true\n    }\n  }\n\n  return false\n}\n\nfunction loadScript(src: string, id: string) {\n  if (isGoogleMapScriptLoaded(id)) {\n    // Make sure the script is loaded\n    return new Promise((resolve) => setTimeout(resolve, 500))\n  }\n\n  const script = document.createElement('script')\n  script.setAttribute('async', '')\n  script.setAttribute('id', id)\n  script.src = src\n  ;(document.querySelector('head') as any).appendChild(script)\n\n  return new Promise<void>((resolve) => {\n    script.onload = () => {\n      resolve()\n    }\n  })\n}\n\ntype Location = {\n  lat: number\n  lng: number\n}\n\nenum MapTypeId {\n  Roadmap = 'roadmap',\n  Satellite = 'satellite',\n  Hybrid = 'hybrid',\n  Terrain = 'terrain'\n}\n\ntype Props = {\n  apiKey: string\n  defaultLocation: Location\n  zoom?: number\n  onChangeLocation?(lat: number, lng: number, currentLocation: any): void\n  onChangeZoom?(zoom: number): void\n  style?: any\n  className?: string\n  mapTypeId?: MapTypeId\n}\n\nfunction isValidLocation(location: Location) {\n  return (\n    location && Math.abs(location.lat) <= 90 && Math.abs(location.lng) <= 180\n  )\n}\n\nconst GOOGLE_SCRIPT_URL =\n  'https://maps.googleapis.com/maps/api/js?libraries=places&key='\n\nconst MapPicker: FC<Props> = ({\n  apiKey,\n  defaultLocation,\n  zoom = 7,\n  onChangeLocation,\n  onChangeZoom,\n  style,\n  className,\n  mapTypeId\n}) => {\n  const MAP_VIEW_ID =\n    'google-map-view-' + Math.random().toString(36).substr(2, 9)\n  const map = React.useRef<any>(null)\n  const marker = React.useRef<any>(null)\n\n  function handleChangeLocation() {\n    if (onChangeLocation) {\n      const currentLocation = marker.current.getPosition()\n      console.log(currentLocation)\n      console.log(marker.current)\n      console.log(marker)\n      onChangeLocation(\n        currentLocation.lat(),\n        currentLocation.lng(),\n        marker.current\n      )\n    }\n  }\n\n  function handleChangeZoom() {\n    onChangeZoom && onChangeZoom(map.current.getZoom())\n  }\n\n  function loadMap() {\n    const Google = (window as any).google\n    const validLocation = isValidLocation(defaultLocation)\n      ? defaultLocation\n      : { lat: 0, lng: 0 }\n\n    map.current = new Google.maps.Map(document.getElementById(MAP_VIEW_ID), {\n      center: validLocation,\n      zoom: zoom,\n      ...(mapTypeId && { mapTypeId })\n    })\n\n    if (!marker.current) {\n      marker.current = new Google.maps.Marker({\n        position: validLocation,\n        map: map.current,\n        draggable: true\n      })\n      Google.maps.event.addListener(\n        marker.current,\n        'dragend',\n        handleChangeLocation\n      )\n    } else {\n      marker.current.setPosition(validLocation)\n    }\n\n    map.current.addListener('click', function (event: any) {\n      const clickedLocation = event.latLng\n\n      marker.current.setPosition(clickedLocation)\n      handleChangeLocation()\n    })\n\n    map.current.addListener('zoom_changed', handleChangeZoom)\n  }\n\n  React.useEffect(() => {\n    loadScript(GOOGLE_SCRIPT_URL + apiKey, 'google-maps-' + apiKey).then(\n      loadMap\n    )\n  }, []) // eslint-disable-line react-hooks/exhaustive-deps\n\n  React.useEffect(() => {\n    if (marker.current) {\n      map.current.setCenter(defaultLocation)\n      marker.current.setPosition(defaultLocation)\n    }\n  }, [defaultLocation])\n\n  React.useEffect(() => {\n    if (map.current) {\n      map.current.setZoom(zoom)\n    }\n  }, [zoom])\n\n  const componentStyle = Object.assign(\n    { width: '100%', height: '600px' },\n    style || {}\n  )\n\n  return (\n    <div id={MAP_VIEW_ID} style={componentStyle} className={className}></div>\n  )\n}\nexport default MapPicker\n"],"names":["isGoogleMapScriptLoaded","id","scripts","document","head","getElementsByTagName","i","length","getAttribute","loadScript","src","Promise","resolve","setTimeout","script","createElement","setAttribute","querySelector","appendChild","onload","MapTypeId","isValidLocation","location","Math","abs","lat","lng","GOOGLE_SCRIPT_URL","MapPicker","apiKey","defaultLocation","zoom","onChangeLocation","onChangeZoom","style","className","mapTypeId","MAP_VIEW_ID","random","toString","substr","map","React","useRef","marker","handleChangeLocation","currentLocation","current","getPosition","console","log","handleChangeZoom","getZoom","loadMap","Google","window","google","validLocation","maps","Map","getElementById","center","Marker","position","draggable","event","addListener","setPosition","clickedLocation","latLng","useEffect","then","setCenter","setZoom","componentStyle","Object","assign","width","height"],"mappings":"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"}